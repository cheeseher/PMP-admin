# 商户订单管理

## 操作栏

### 基础操作说明

1. **重新推送**
   - 允许管理员手动触发一次或多次通知的重新发送
   - 平台会再次向商户配置的回调地址发送支付结果通知
   - 仅在 "交易成功 / 补单成功" 状态下可点击；状态本身不改变

2. **手动补单**
   - 允许管理员在确认某笔订单确实已经在上游支付成功后，手动将平台系统内的这笔订单状态修改为"补单成功"

3. **手动回调**
   - 对未成功状态的订单强行触发一次回调
   - 执行后同样落到 "补单成功"
   - 仅对 非成功状态 订单开放按钮

4. **修改金额**
   - 平台不向商户发送回调通知
   - 修改后视为补单成功状态

5. **双向撤销**
   - 交易撤销状态的订单不支持手动回调和修改金额
   - 仅交易成功或补单成功状态的订单支持双向撤销
   - 订单双向撤销后，订单状态变为交易撤销，撤销后不再向商户回调

---

## 订单状态说明 + 对应可执行运营操作

### 1. 订单创建
**说明**：商⼾成功下单，平台尚未⽣成平台单号。商户会主动查询订单的状态的， 订单创建这个状态对于系统来说很少，是给运营判断的，如果大批量处于订单创建状态，肯定是由于系统处理不过来

可执行操作：
- **手动回调**
  - 行为：平台向商户主动推送"订单结果通知"
  - 执行结果：订单状态变更为 补单成功
  - 是否记账：是
  - 是否回调商户：是

- **修改金额**
  - 行为：修改订单金额，系统重入账
  - 执行结果：订单状态变更为 补单成功
  - 是否记账：是
  - 是否回调商户：否

### 2. 待付款
**说明**：订单已成功分发通道，平台返回支付链接，C 端用户尚未完成支付。

可执行操作：
- **手动补单**
  - 行为：运营确认上游已支付成功，手动将订单标记为成功
  - 执行结果：订单状态变更为 补单成功
  - 是否记账：是
  - 是否回调商户：是

- **手动回调**
  - 行为：平台向商户主动推送"订单结果通知"
  - 执行结果：订单状态变更为 补单成功
  - 是否记账：是
  - 是否回调商户：是

- **修改金额**
  - 行为：修改订单金额，系统冲销原账变并重新记账
  - 执行结果：订单状态变更为 补单成功
  - 是否记账：是
  - 是否回调商户：否

### 3. 交易成功
**说明**：平台已收到通道"成功"回调，订单已正式入账，并已回调商户。

可执行操作：
- **修改金额**
  - 行为：修改订单金额，系统自动冲销原账变并重新生成新的账变
  - 执行结果：订单状态变更为补单成功
  - 是否记账：是（冲销旧账变，生成新账变）
  - 是否回调商户：否

- **重新推送**
  - 行为：平台再次向商户配置的回调地址推送订单成功结果
  - 执行结果：订单状态不变
  - 是否记账：否
  - 是否回调商户：是（重新发送已有回调数据）

- **双向撤销**
  - 行为：运营点击"撤销"操作，系统冲销平台、商户、上游账务，订单标记为终止
  - 执行结果：订单状态变更为 交易撤销
  - 是否记账：是（先冲销之前的账变）
  - 是否回调商户：否（撤销后不再回调）

### 4. 补单成功
**说明**：订单原本未成功，通过运营执行"手动补单 / 手动回调 / 修改金额"等方式被补记为成功，并生成账变。此状态视为"人工成功"。

可执行操作：
- **修改金额**
  - 行为：修改订单金额，系统冲销原账变并重新生成账变
  - 执行结果：订单状态保持为 补单成功
  - 是否记账：是（重记账变）
  - 是否回调商户：否

- **重新推送**
  - 行为：平台再次向商户推送订单成功结果
  - 执行结果：订单状态不变
  - 是否记账：否
  - 是否回调商户：是（重新发送已成功的回调内容）

- **双向撤销**
  - 行为：撤销订单，回滚账务（平台、商户、上游）
  - 执行结果：订单状态变更为 交易撤销
  - 是否记账：是（冲销补单账变）
  - 是否回调商户：否（撤销后不再通知商户）

### 5. 下单失败
**说明**：已成功⽣成平台单号，订单未能成功获取上游通道链接，或所有通道明确返回失败。（状态不需要给商户推送）
- 不支持任何运营操作

### 6. 交易关闭
**说明**：订单已成功分发通道，但 C 端用户长时间未支付，平台自动关闭订单，终止处理。

可执行操作：
- **手动补单**
  - 行为：运营确认上游已成功支付，手动将订单补记为成功
  - 执行结果：订单状态变更为 补单成功
  - 是否记账：是
  - 是否回调商户：是

- **手动回调**
  - 行为：平台向商户主动推送"订单成功通知"
  - 执行结果：订单状态变更为 补单成功
  - 是否记账：是
  - 是否回调商户：是

- **修改金额**
  - 行为：修改订单金额，系统重记账变
  - 执行结果：订单状态变更为 补单成功
  - 是否记账：是
  - 是否回调商户：否

### 7. 交易撤销
**说明**：已成功（含交易成功 / 补单成功）的订单被运营执行"双向撤销"操作，平台、商户、上游三方账务回滚，订单标记为终止。
- 不支持任何运营操作

---

## 字段说明

| 字段 | 说明 |
|------|------|
| **推送状态** | 成功：平台回调送达，商户 HTTP 200 且正文包含 SUCCESS<br>失败：任意非 200、超时、正文不含 SUCCESS，或平台未收到响应 |
| **推送结果** | 把商户真实响应内容原样写入，方便运营查看原因、手动重推 |
| **隔日补单** | 订单创建时间是10号，订单完成时间是11号的成功订单（包含交易成功和补单成功订单），这种订单属于隔日补单 |
| **入账金额** | =订单金额-手续费 |
| **通道成本** | =订单金额*通道费率 |
| **手续费** | =订单金额*商户费率 |

---

## 其他说明（运营需求记录）

### 重要提示

- **修改金额**的订单，系统不会向商户发送回调通知
- **补单成功**及**交易成功**的订单支持：
  - 重新推送
  - 双向撤销
  - 修改金额
- 其他状态订单支持：
  - 手动回调
  - 修改金额
- **交易撤销**状态的订单不支持手动回调和修改金额

### 状态变更规则

- 订单手动回调后，视为**补单成功**状态
- 订单双向撤销后，为**交易撤销**状态
- 订单修改金额后，视为**补单成功**状态
- 订单状态改变后，更新订单完成时间