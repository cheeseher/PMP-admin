# 思方支付管理系统 - 商户产品关联

## 业务目标

展示和管理商户与支付产品的关联关系，支持对商户可使用的支付产品及其费率、权重进行查询和管理，为商户交易提供支付服务配置基础。

## 业务逻辑

### 商户产品关联查询

**查询条件**:
- ID：精确匹配关联记录的唯一标识
- 商户账号：模糊匹配商户账号
- 商户名称：模糊匹配商户名称
- 支付产品名称：同时匹配支付产品名称或产品编码

### 商户产品关联数据

**关联属性**:
- 商户信息：商户账号、商户名称
- 产品信息：支付产品名称、支付产品编码
- 费率配置：商户使用该产品的费率（百分比形式）
- 权重配置：在多产品并存时的选择权重
- 备注：关联的补充说明

### 费率管理逻辑

**费率设置规则**:
- 商户费率可以继承自产品默认费率，也可以单独设置
- 商户费率必须大于等于产品的通道成本费率
- 商户费率与通道成本费率的差额为平台利润
- 费率计算公式：
  ```
  平台利润 = 交易金额 × (商户费率 - 通道成本费率)
  ```

### 权重管理逻辑

**权重应用场景**:
- 当一个商户关联多个相同类型的产品时，系统通过权重决定使用哪个产品
- 权重越高，被选中的概率越大
- 权重计算公式：
  ```
  产品被选中概率 = 该产品权重 / 商户所有同类产品权重之和
  ```

### 关联管理规则

**关联约束**:
- 一个商户可以关联多个支付产品
- 同一商户不应关联重复的支付产品
- 商户必须至少关联一个产品才能进行交易
- 停用商户与产品的关联后，该商户将无法使用该产品进行支付

## 数据导出逻辑

- 支持将当前筛选条件下的关联数据导出为Excel文件
- 导出内容包括商户信息、产品信息、费率和权重等
- 导出文件命名规则：商户产品关联_YYYYMMDD_HHMMSS.xlsx

## 权限控制

- 查看权限：具有"商户管理/产品关联查看"权限的角色可访问列表
- 操作权限：
  - 关联新增：需要"商户管理/产品关联新增"权限
  - 关联编辑：需要"商户管理/产品关联编辑"权限
  - 关联删除：需要"商户管理/产品关联删除"权限
- 数据范围权限：管理员可能被限制只能查看和管理指定范围的商户 