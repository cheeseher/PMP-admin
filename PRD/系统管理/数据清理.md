# 数据清理
## 页面功能
用于定期清理系统中的历史数据、日志等，以保持系统性能与存储可控
## 页面结构
- 筛选区域：保留天数、时间范围、状态、自动清理开关、每日时间点、清理模式
- 操作区域：执行一次性清理、保存设置、预估清理量
- 表格区域：清理任务记录（任务ID、范围、模式、预计条数、结果、执行时间）
- 分页区域：任务记录分页
### 商户订单清理
## 字段说明
| 字段名 | 字段含义 | 交互类型 | 是否必填 | 备注 |
|--------|----------|----------|----------|------|
| 保留最近订单 | 保留的天数 | 下拉选择 | 是 | 选项：7、30、60、90、180；默认30 |
| 清理时间范围 | 指定清理的时间范围 | 日期范围 | 否 | 精准匹配；若选择则按范围清理，忽略“保留最近订单” |
| 订单状态 | 需清理的订单状态 | 下拉多选 | 否 | 精准匹配；选项：created、success、pending、failed、canceled、reorder_success、closed；默认全部 |
| 自动清理 | 开启每日自动任务 | 开关 | 否 | 默认关闭 |
| 清理时间点 | 每日自动执行时间 | 时间选择 | 条件必填 | 当“自动清理”为开时必填；格式HH:mm |
| 清理模式 | 清理的删除方式 | 单选 | 否 | 选项：逻辑删除、物理删除；默认逻辑删除 |
| 预估清理量 | 执行前预估条数 | 只读展示 | 否 | 点击“预估清理量”后显示估算值 |
## 交互说明
- 按钮显示：当“自动清理”为关闭时，显示“执行一次性清理”，不显示“保存设置”；当“自动清理”为开启时，不显示“执行一次性清理”，仅显示“保存设置”。
- 按钮样式：两个按钮统一为主色（primary）蓝色，视觉一致
- 手动清理：点击“执行一次性清理”，弹出二次确认，确认后启动异步任务并提示“任务已开始执行”
- 保存设置：保存保留天数、状态、清理模式、自动清理与每日时间点，用于后端定时任务执行
- 优先级规则：若指定“清理时间范围”，则以范围为准；否则按“保留最近订单”的天数计算
- 状态筛选：订单状态为精准匹配；未选择表示对所有状态进行清理
- 风险提示：物理删除不可恢复；逻辑删除可在后台恢复（需管理员权限）
- 结果反馈：清理任务完成后在“任务记录”中展示结果与影响条数
### 其他清理
## 字段说明
| 字段名 | 字段含义 | 交互类型 | 是否必填 | 备注 |
|--------|----------|----------|----------|------|
| 清理范围 | 选择数据类型 | 复选框组 | 是 | 选项：商户订单、结算单、操作日志；至少选一项；默认全选 |
| 保留最近数据 | 保留的天数 | 下拉选择 | 是 | 选项：7、30、60、90、180；默认30 |
| 自动清理 | 开启每日自动任务 | 开关 | 否 | 默认关闭 |
| 清理时间点 | 每日自动执行时间 | 时间选择 | 条件必填 | 当“自动清理”为开时必填；格式HH:mm |
| 清理模式 | 清理的删除方式 | 单选 | 否 | 选项：逻辑删除、物理删除；默认逻辑删除 |
| 预估清理量 | 执行前预估条数 | 只读展示 | 否 | 点击“预估清理量”后显示各范围的估算值 |
## 交互说明
- 按钮显示：当“自动清理”为关闭时，显示“执行一次性清理”，不显示“保存设置”；当“自动清理”为开启时，不显示“执行一次性清理”，仅显示“保存设置”。
- 按钮样式：两个按钮统一为主色（primary）蓝色，视觉一致
- 执行一次性清理：对所选“清理范围”按“保留最近数据”与“清理模式”执行，弹二次确认后启动任务
- 保存设置：保存清理范围、保留天数、自动清理与时间点，用于后端定时任务执行
- 范围规则：多选时分别计算与执行，任务记录分项展示每类数据的清理结果
 - 禁用规则：当“清理范围”未选择任何项时，“执行一次性清理”按钮置灰不可点击，并提示“请至少选择一个清理范围”。
## 风险与权限
- 风险确认：所有清理操作需弹出带影响说明的二次确认框，明确不可恢复的风险（物理删除）
- 权限控制：仅管理员角色可执行清理与修改设置；普通用户无权访问
- 审计日志：记录操作者、时间、清理范围、模式、预计与实际影响条数、结果状态
## 状态与提示
- 任务状态：排队中、执行中、成功、失败
- 成功提示：展示影响条数与分类统计
- 失败提示：展示失败原因并保留任务记录以供排查
 - 交互实现：已在页面实现按钮显隐逻辑（随“自动清理”开关切换）