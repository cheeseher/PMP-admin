# 支付产品管理

支付产品管理模块用于配置和管理系统支持的支付产品，包括产品基本信息、费率设置、供应商通道配置以及商户同步配置等功能。

## 功能概述

- 支付产品列表展示
- 新增/编辑支付产品
- 产品状态管理
- 费率设置与生效管理
- 配置同步到商户功能
- 供应商通道配置与权重设置

## 字段说明

### 基本信息字段

| 字段名称       | 字段标识         | 是否必填 | 是否唯一 | 是否枚举 | 交互类型   | 是否多选 | 是否支持搜索 | 说明                     |
|------------|--------------|------|------|-------|--------|------|--------|------------------------|
| 支付产品ID     | id           | 是    | 是    | 否     | 文本     | 否    | 是      | 系统自动生成                |
| 支付产品名称     | productName  | 是    | 是    | 否     | 文本输入框  | 否    | 是      | 产品显示名称                |
| 支付产品编码     | productCode  | 是    | 是    | 否     | 文本输入框  | 否    | 是      | 唯一标识符，仅支持字母、数字和下划线    |
| 商户费率       | feeRate      | 是    | 否    | 否     | 数字输入框  | 否    | 否      | 百分比值，0-100            |
| 状态         | status       | 是    | 否    | 是     | 开关     | 否    | 是      | ONLINE/OFFLINE        |
| 轮询方式       | isPolling    | 是    | 否    | 是     | 下拉选择   | 否    | 否      | POLLING(轮询)/WEIGHT(权重) |
| 备注         | remark       | 否    | 否    | 否     | 文本域    | 否    | 是      | 产品说明                  |

### 同步配置字段

| 字段名称      | 字段标识        | 是否必填 | 是否唯一 | 是否枚举 | 交互类型  | 是否多选 | 是否支持搜索 | 说明                                         |
|-----------|-------------|------|------|-------|-------|------|--------|-------------------------------------------|
| 同步配置到商户   | syncOption   | 是    | 否    | 是     | 单选按钮组 | 否    | 否      | 三选一：none(不同步)/immediate(立即同步)/scheduled(定时同步) |
| 生效时间      | effectiveTime | 条件必填 | 否    | 否     | 日期时间选择器 | 否    | 否      | 当syncOption为scheduled时必填，为none时选填            |
| 超级密码      | superPassword | 条件必填 | 否    | 否     | 密码输入框 | 否    | 否      | 当syncOption不为none时必填                         |

### 供应商通道字段

| 字段名称    | 字段标识       | 是否必填 | 是否唯一 | 是否枚举 | 交互类型   | 是否多选 | 是否支持搜索 | 说明             |
|---------|------------|------|------|-------|--------|------|--------|----------------|
| 供应商通道   | channelCode | 是    | 否    | 是     | 下拉选择框  | 是    | 是      | 支持多选          |
| 通道名称    | channelName | 自动   | 否    | 否     | 表格展示   | 否    | 否      | 根据选择的通道自动显示    |
| 通道编码    | channelCode | 自动   | 否    | 否     | 表格展示   | 否    | 否      | 根据选择的通道自动显示    |
| 通道费率    | channelFeeRate | 自动   | 否    | 否     | 表格展示   | 否    | 否      | 根据选择的通道自动显示    |
| 权重     | weight     | 是    | 否    | 否     | 数字输入框  | 否    | 否      | 1-100，仅在isPolling为WEIGHT时有效 |

## 交互说明

### 同步配置交互规则

1. **不同步(none)**：
   - 选择"不同步"时，生效时间为非必填项
   - 如果设置了生效时间，在到达指定时间后，只修改模板配置，不影响商户
   - 生效时间选择器旁显示提示"(仅修改模板配置，不影响商户)"

2. **立即同步(immediate)**：
   - 选择"立即同步"时，隐藏生效时间设置
   - 保存后立即将配置同步到所有关联商户
   - 如果之前选择的是"定时同步"并设置了时间，切换到"立即同步"时会弹出确认提示

3. **定时同步(scheduled)**：
   - 选择"定时同步"时，生效时间为必填项
   - 如果未设置生效时间，自动默认为当前时间+1小时
   - 在未生效状态下，生效时间选择器旁显示倒计时"距离生效还有：X天X小时X分钟X秒"
   - 如果时间已过，显示"已生效"标签

### 费率定时生效功能

当配置了定时生效（无论是否同步到商户）：
1. 表格中对应的产品行会显示定时生效状态和倒计时
2. 待生效的新值会以"待生效: xxx"的形式显示在当前值下方
3. 系统自动在指定时间更新配置，对于选择了"定时同步"的配置，同时更新所有关联商户

## 操作流程

1. **编辑产品配置**：
   - 填写基本产品信息和费率
   - 选择供应商通道并设置权重
   - 选择同步方式：不同步/立即同步/定时同步
   - 根据同步方式，设置生效时间（如需要）
   - 输入超级密码（如需要）
   - 保存配置

2. **配置生效过程**：
   - 立即同步：保存后立即生效，修改产品和商户配置
   - 定时同步：到达指定时间后，自动更新产品和商户配置
   - 不同步+设置生效时间：到达指定时间后，只更新产品配置，不影响商户

## 注意事项

1. 超级密码仅在涉及商户配置变更时（立即同步/定时同步）需要输入
2. 定时任务执行前可以再次编辑，修改同步方式或生效时间
3. 生效时间必须大于当前时间
4. 费率变更对商户可能产生重大影响，请谨慎操作 